<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of meshVertexClustering</title>
  <meta name="keywords" content="meshVertexClustering">
  <meta name="description" content="MESHVERTEXCLUSTERING Simplifies a mesh using vertex clustering.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003-2019 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">matGeom</a> &gt; <a href="index.html">meshes3d</a> &gt; meshVertexClustering.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for matGeom\meshes3d&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>meshVertexClustering
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>MESHVERTEXCLUSTERING Simplifies a mesh using vertex clustering.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function varargout = meshVertexClustering(vertices, faces, spacing, varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">MESHVERTEXCLUSTERING Simplifies a mesh using vertex clustering.

   [V2, F2] = meshVertexClustering(V, F, SPACING)
   [V2, F2] = meshVertexClustering(MESH, SPACING)
   MESH2 = meshVertexClustering(...)

   Simplifies a mesh using vertex clustering. Input mesh is specified
   either by a pair V, F containing the vertex coordinates and the faces
   informations, or by a structure with fields 'vertices' and 'faces'.

   The SPACING input defines the size of the grid. It can be either a
   scalar (uniform grid) or a 1-by-3 row vector. 

   The output is specified either in two outputs, or in a structure with
   fields 'vertices' and 'faces'.

   Example
     [x, y, z]  = meshgrid(1:100, 1:100, 1:100);
     img = hypot3(x-51.12, y-52.23, z-53.34);
     [faces, vertices] = isosurface(img, 45);
     [v2, f2] = meshVertexClustering(vertices, faces, 10);
     figure; axis equal; axis([0 100 0 100 0 100]);
     drawMesh(v2, f2);

   See also
     reducepatch, <a href="smoothMesh.html" class="code" title="function varargout = smoothMesh(varargin)">smoothMesh</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="triangulateFaces.html" class="code" title="function [tri, inds] = triangulateFaces(faces)">triangulateFaces</a>	TRIANGULATEFACES Convert face array to an array of triangular faces.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = meshVertexClustering(vertices, faces, spacing, varargin)</a>
0002 <span class="comment">%MESHVERTEXCLUSTERING Simplifies a mesh using vertex clustering.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%   [V2, F2] = meshVertexClustering(V, F, SPACING)</span>
0005 <span class="comment">%   [V2, F2] = meshVertexClustering(MESH, SPACING)</span>
0006 <span class="comment">%   MESH2 = meshVertexClustering(...)</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%   Simplifies a mesh using vertex clustering. Input mesh is specified</span>
0009 <span class="comment">%   either by a pair V, F containing the vertex coordinates and the faces</span>
0010 <span class="comment">%   informations, or by a structure with fields 'vertices' and 'faces'.</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%   The SPACING input defines the size of the grid. It can be either a</span>
0013 <span class="comment">%   scalar (uniform grid) or a 1-by-3 row vector.</span>
0014 <span class="comment">%</span>
0015 <span class="comment">%   The output is specified either in two outputs, or in a structure with</span>
0016 <span class="comment">%   fields 'vertices' and 'faces'.</span>
0017 <span class="comment">%</span>
0018 <span class="comment">%   Example</span>
0019 <span class="comment">%     [x, y, z]  = meshgrid(1:100, 1:100, 1:100);</span>
0020 <span class="comment">%     img = hypot3(x-51.12, y-52.23, z-53.34);</span>
0021 <span class="comment">%     [faces, vertices] = isosurface(img, 45);</span>
0022 <span class="comment">%     [v2, f2] = meshVertexClustering(vertices, faces, 10);</span>
0023 <span class="comment">%     figure; axis equal; axis([0 100 0 100 0 100]);</span>
0024 <span class="comment">%     drawMesh(v2, f2);</span>
0025 <span class="comment">%</span>
0026 <span class="comment">%   See also</span>
0027 <span class="comment">%     reducepatch, smoothMesh</span>
0028 
0029 <span class="comment">% ------</span>
0030 <span class="comment">% Author: David Legland</span>
0031 <span class="comment">% E-mail: david.legland@inrae.fr</span>
0032 <span class="comment">% Created: 2019-01-28, using Matlab 9.5.0.944444 (R2018b)</span>
0033 <span class="comment">% Copyright 2019-2024 INRA - Cepia Software Platform</span>
0034 
0035 <span class="comment">%% Initialisation</span>
0036 
0037 <span class="keyword">if</span> isstruct(vertices)
0038     <span class="keyword">if</span> nargin &gt; 2
0039         varargin = [{spacing} varargin(:)];
0040     <span class="keyword">end</span>
0041     spacing = faces;
0042 
0043     mesh = vertices;
0044     vertices = mesh.vertices;
0045     faces = mesh.faces;
0046 <span class="keyword">end</span>
0047 
0048 <span class="comment">% ensure input mesh is a triangulation</span>
0049 faces = <a href="triangulateFaces.html" class="code" title="function [tri, inds] = triangulateFaces(faces)">triangulateFaces</a>(faces);
0050 
0051 <span class="comment">% ensure spacing is a 1-by-3 array</span>
0052 <span class="keyword">if</span> isscalar(spacing)
0053     spacing = [spacing spacing spacing];
0054 <span class="keyword">end</span>
0055 
0056 <span class="comment">% extract grid origin</span>
0057 origin = [0 0 0];
0058 <span class="keyword">if</span> ~isempty(varargin)
0059     origin = varargin{1};
0060 <span class="keyword">end</span>
0061 
0062 
0063 <span class="comment">%% Apply grid simplification</span>
0064 
0065 <span class="comment">% identify the vertices belonging to the same grid</span>
0066 [v2, I, J] = unique(round(bsxfun(@rdivide, bsxfun(@minus, vertices, origin), spacing)), <span class="string">'rows'</span>);
0067 
0068 
0069 <span class="comment">%% compute reduced vertex coordinates</span>
0070 
0071 <span class="comment">% compute coordinates of new vertices</span>
0072 <span class="keyword">for</span> iVertex = 1:length(I)
0073     gridVertices = vertices(J == iVertex, :);
0074     v2(iVertex, :) = mean(gridVertices, 1);
0075 <span class="keyword">end</span>
0076 
0077 
0078 <span class="comment">%% Compute new faces</span>
0079 
0080 <span class="comment">% create empty array</span>
0081 faces2 = zeros(0, 3);
0082 
0083 <span class="comment">% iterate over old faces, and keep only faces whose vertices belong to</span>
0084 <span class="comment">% different cell grids</span>
0085 nFaces = size(faces, 1);
0086 <span class="keyword">for</span> iFace = 1:nFaces
0087     <span class="comment">% current face</span>
0088     face = faces(iFace, :);
0089     
0090     <span class="comment">% equivalent face with new vertices</span>
0091     face2 = J(face)';
0092     
0093     <span class="comment">% some vertices may belong to same cell, so we need to adjust</span>
0094     <span class="comment">% processing</span>
0095     nInds = length(unique(face2));
0096     <span class="keyword">if</span> nInds == 3
0097         <span class="comment">% vertices belong to three different cells -&gt; create a new face</span>
0098         
0099         <span class="comment">% keep smaller vertex at first position</span>
0100         [tmp, indMin] = min(face2); <span class="comment">%#ok&lt;ASGLU&gt;</span>
0101         face2 = circshift(face2, [1-indMin 0]);
0102         
0103         <span class="comment">% append the new face to the array</span>
0104         faces2 = [faces2 ; face2]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0105     <span class="keyword">end</span>
0106 <span class="keyword">end</span>
0107 
0108 <span class="comment">% remove duplicate faces</span>
0109 faces2 = unique(faces2, <span class="string">'rows'</span>);
0110 
0111 <span class="keyword">if</span> nargout == 1
0112     varargout{1} = struct(<span class="string">'vertices'</span>, v2, <span class="string">'faces'</span>, faces2);
0113 <span class="keyword">else</span>
0114     varargout = {v2, faces2};
0115 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 21-Nov-2024 11:30:22 by <strong><a href="https://github.com/gllmflndn/m2html">m2html</a></strong> &copy; 2003-2022</address>
</body>
</html>