<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of clipConvexPolyhedronByPlane</title>
  <meta name="keywords" content="clipConvexPolyhedronByPlane">
  <meta name="description" content="CLIPCONVEXPOLYHEDRONBYPLANE Clip a convex polyhedron by a plane.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003-2019 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">matGeom</a> &gt; <a href="index.html">meshes3d</a> &gt; clipConvexPolyhedronByPlane.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for matGeom\meshes3d&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>clipConvexPolyhedronByPlane
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>CLIPCONVEXPOLYHEDRONBYPLANE Clip a convex polyhedron by a plane.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [nodes2, faces2] = clipConvexPolyhedronByPlane(nodes, faces, plane) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">CLIPCONVEXPOLYHEDRONBYPLANE Clip a convex polyhedron by a plane.

   [NODES2, FACES2] = clipConvexPolyhedronByPlane(NODES, FACES, PLANE)

   return the new (convex) polyhedron whose vertices are 'below' the
   specified plane, and with faces clipped accordingly. NODES2 contains
   clipped vertices and new created vertices, FACES2 contains references
   to NODES2 vertices.

   Example
     [N, F] = createCube;
     P = createPlane([.5 .5 .5], [1 1 1]);
     [N2, F2] = clipConvexPolyhedronByPlane(N, F, P);
     figure('color','w'); view(3); axis equal
     drawPolyhedron(N2, F2);
 
     [v, f] = createSoccerBall;
     p = createPlane([-.5 .5 -.5], [1 1 1]);
     [v2, f2] = clipConvexPolyhedronByPlane(v, f, p);
     figure('color','w'); view(3); axis equal
     drawMesh(v, f, 'faceColor', 'none');
     drawMesh(v2, f2);

   See also
     meshes3d, <a href="polyhedra.html" class="code" title="function polyhedra(varargin)">polyhedra</a>, planes3d</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../matGeom/geom2d/minDistancePoints.html" class="code" title="function varargout = minDistancePoints(p1, varargin)">minDistancePoints</a>	MINDISTANCEPOINTS Minimal distance between several points.</li><li><a href="../../matGeom/geom3d/angleSort3d.html" class="code" title="function varargout = angleSort3d(pts, varargin)">angleSort3d</a>	ANGLESORT3D Sort 3D coplanar points according to their angles in plane.</li><li><a href="../../matGeom/geom3d/clipPolygonByPlane3d.html" class="code" title="function poly2 = clipPolygonByPlane3d(poly, plane, varargin)">clipPolygonByPlane3d</a>	CLIPPOLYGONBYPLANE3D Clip a 3D polygon with a plane.</li><li><a href="../../matGeom/geom3d/isBelowPlane.html" class="code" title="function below = isBelowPlane(point, varargin)">isBelowPlane</a>	ISBELOWPLANE Test whether a point is below or above a plane.</li><li><a href="../../matGeom/geom3d/planeNormal.html" class="code" title="function n = planeNormal(plane)">planeNormal</a>	PLANENORMAL Compute the normal to a plane.</li><li><a href="meshFaceNormals.html" class="code" title="function normals = meshFaceNormals(varargin)">meshFaceNormals</a>	MESHFACENORMALS Compute normal vector of faces in a 3D mesh.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="createDurerPolyhedron.html" class="code" title="function varargout = createDurerPolyhedron(varargin)">createDurerPolyhedron</a>	CREATEDURERPOLYHEDRON  Create a mesh representing Durer's polyhedron .</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [nodes2, faces2] = clipConvexPolyhedronByPlane(nodes, faces, plane)</a>
0002 <span class="comment">%CLIPCONVEXPOLYHEDRONBYPLANE Clip a convex polyhedron by a plane.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%   [NODES2, FACES2] = clipConvexPolyhedronByPlane(NODES, FACES, PLANE)</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%   return the new (convex) polyhedron whose vertices are 'below' the</span>
0007 <span class="comment">%   specified plane, and with faces clipped accordingly. NODES2 contains</span>
0008 <span class="comment">%   clipped vertices and new created vertices, FACES2 contains references</span>
0009 <span class="comment">%   to NODES2 vertices.</span>
0010 <span class="comment">%</span>
0011 <span class="comment">%   Example</span>
0012 <span class="comment">%     [N, F] = createCube;</span>
0013 <span class="comment">%     P = createPlane([.5 .5 .5], [1 1 1]);</span>
0014 <span class="comment">%     [N2, F2] = clipConvexPolyhedronByPlane(N, F, P);</span>
0015 <span class="comment">%     figure('color','w'); view(3); axis equal</span>
0016 <span class="comment">%     drawPolyhedron(N2, F2);</span>
0017 <span class="comment">%</span>
0018 <span class="comment">%     [v, f] = createSoccerBall;</span>
0019 <span class="comment">%     p = createPlane([-.5 .5 -.5], [1 1 1]);</span>
0020 <span class="comment">%     [v2, f2] = clipConvexPolyhedronByPlane(v, f, p);</span>
0021 <span class="comment">%     figure('color','w'); view(3); axis equal</span>
0022 <span class="comment">%     drawMesh(v, f, 'faceColor', 'none');</span>
0023 <span class="comment">%     drawMesh(v2, f2);</span>
0024 <span class="comment">%</span>
0025 <span class="comment">%   See also</span>
0026 <span class="comment">%     meshes3d, polyhedra, planes3d</span>
0027 <span class="comment">%</span>
0028 
0029 <span class="comment">% ------</span>
0030 <span class="comment">% Author: David Legland</span>
0031 <span class="comment">% E-mail: david.legland@inrae.fr</span>
0032 <span class="comment">% Created: 2007-09-14, using Matlab 7.4.0.287 (R2007a)</span>
0033 <span class="comment">% Copyright 2007-2024 INRA - BIA PV Nantes - MIAJ Jouy-en-Josas</span>
0034 
0035 <span class="comment">%% Preprocessing</span>
0036 
0037 <span class="comment">% used for identifying identical vertices</span>
0038 tol = 1e-10;
0039 
0040 <span class="comment">% if faces is a numeric array, convert it to cell array</span>
0041 <span class="keyword">if</span> isnumeric(faces)
0042     faces2 = cell(size(faces, 1), 1);
0043     <span class="keyword">for</span> f = 1:length(faces2)
0044         faces2{f} = faces(f,:);
0045     <span class="keyword">end</span>
0046     faces = faces2;
0047 <span class="keyword">end</span>
0048 
0049 <span class="comment">% find vertices below the plane</span>
0050 b = <a href="../../matGeom/geom3d/isBelowPlane.html" class="code" title="function below = isBelowPlane(point, varargin)">isBelowPlane</a>(nodes, plane);
0051 
0052 <span class="comment">% initialize results</span>
0053 Nn  = size(nodes, 1);
0054 nodes2 = zeros(0, 3);   <span class="comment">% list of new nodes</span>
0055 faces2 = faces;         <span class="comment">% list of new faces. Start with initial list, and remove some of them</span>
0056 
0057 
0058 <span class="comment">%% Main iteration on faces</span>
0059 
0060 <span class="comment">% iterate on each face, and test if either:</span>
0061 <span class="comment">%   - all points below plane -&gt; keep all face</span>
0062 <span class="comment">%   - all points up plane -&gt; remove face</span>
0063 <span class="comment">%   - both -&gt; clip the polygon</span>
0064 keep = true(length(faces), 1);
0065 <span class="keyword">for</span> f = 1:length(faces)
0066     <span class="comment">% current face</span>
0067     face = faces{f};
0068     bf = b(face);
0069 
0070     <span class="comment">% face totally above plane</span>
0071     <span class="keyword">if</span> sum(bf) == 0
0072         keep(f) = false;
0073         <span class="keyword">continue</span>;
0074     <span class="keyword">end</span>
0075 
0076     <span class="comment">% face totally below plane</span>
0077     <span class="keyword">if</span> sum(bf == 1) == length(bf)
0078         <span class="keyword">continue</span>;
0079     <span class="keyword">end</span>
0080 
0081     <span class="comment">% clip polygon formed by face</span>
0082     poly = nodes(face, :);
0083     clipped = <a href="../../matGeom/geom3d/clipPolygonByPlane3d.html" class="code" title="function poly2 = clipPolygonByPlane3d(poly, plane, varargin)">clipPolygonByPlane3d</a>(poly, plane);
0084 
0085     <span class="comment">% identify indices of polygon vertices</span>
0086     inds = zeros(1, size(clipped, 1));
0087     faceb = face(bf==1); <span class="comment">% indices of vertices still in clipped face</span>
0088     [minDists, I] = <a href="../../matGeom/geom2d/minDistancePoints.html" class="code" title="function varargout = minDistancePoints(p1, varargin)">minDistancePoints</a>(nodes(faceb,:), clipped); <span class="comment">%#ok&lt;ASGLU&gt;</span>
0089     <span class="keyword">for</span> i = 1:length(I)
0090         inds(I(i)) = faceb(i);
0091     <span class="keyword">end</span>
0092 
0093     <span class="comment">% indices of new points in clipped polygon</span>
0094     indNews = find(inds == 0);
0095     
0096     <span class="keyword">if</span> size(nodes2, 1) &lt; 2
0097         nodes2 = [nodes2; clipped(indNews, :)]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0098         inds(indNews(1)) = Nn + 1;
0099         inds(indNews(2)) = Nn + 2;
0100         faces2{f} = inds;
0101         <span class="keyword">continue</span>;
0102     <span class="keyword">end</span>
0103      
0104     <span class="comment">% distances from new vertices to already added vertices</span>
0105     [minDists, I] = <a href="../../matGeom/geom2d/minDistancePoints.html" class="code" title="function varargout = minDistancePoints(p1, varargin)">minDistancePoints</a>(clipped(indNews, :), nodes2);
0106     
0107     <span class="comment">% compute index of first vertex</span>
0108     <span class="keyword">if</span> minDists(1) &lt; tol
0109         inds(indNews(1)) = Nn + I(1);
0110     <span class="keyword">else</span>
0111         nodes2 = [nodes2; clipped(indNews(1), :)]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0112         inds(indNews(1)) = Nn + size(nodes2, 1);
0113     <span class="keyword">end</span>
0114     
0115     <span class="comment">% compute index of second vertex</span>
0116     <span class="keyword">if</span> minDists(2) &lt; tol
0117         inds(indNews(2)) = Nn + I(2);
0118     <span class="keyword">else</span>
0119         nodes2 = [nodes2; clipped(indNews(2), :)]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0120         inds(indNews(2)) = Nn + size(nodes2, 1);
0121     <span class="keyword">end</span>
0122     
0123     <span class="comment">% stores the modified face</span>
0124     faces2{f} = inds;
0125 <span class="keyword">end</span>
0126 
0127 
0128 <span class="comment">%% Postprocessing</span>
0129 
0130 <span class="comment">% creates a new face formed by the added nodes</span>
0131 [sortedNodes, I] = <a href="../../matGeom/geom3d/angleSort3d.html" class="code" title="function varargout = angleSort3d(pts, varargin)">angleSort3d</a>(nodes2);
0132 
0133 <span class="comment">% compute normal vector of new face, and reverse order if face points in</span>
0134 <span class="comment">% the opposite direction as plane normal</span>
0135 newFaceNormal = <a href="meshFaceNormals.html" class="code" title="function normals = meshFaceNormals(varargin)">meshFaceNormals</a>(sortedNodes, 1:length(sortedNodes));
0136 <span class="keyword">if</span> dot(newFaceNormal, <a href="../../matGeom/geom3d/planeNormal.html" class="code" title="function n = planeNormal(plane)">planeNormal</a>(plane)) &lt; 0
0137     I(2:end) = I(end:-1:2);
0138 <span class="keyword">end</span>
0139 
0140 <span class="comment">% compute vertex indices of new face</span>
0141 newFace = I' + Nn;
0142 
0143 <span class="comment">% remove faces outside plane and add the new face</span>
0144 faces2 = {faces2{keep}, newFace};
0145 
0146 <span class="comment">% remove clipped nodes, and add new nodes to list of nodes</span>
0147 N2 = size(nodes2, 1);
0148 nodes2 = [nodes(b, :); nodes2];
0149 
0150 <span class="comment">% new nodes are inside half-space by definition</span>
0151 b = [b; ones(N2, 1)];
0152 
0153 <span class="comment">% create look up table between old indices and new indices</span>
0154 inds = zeros(size(nodes2, 1), 1);
0155 indb = find(b);
0156 <span class="keyword">for</span> i = 1:length(indb)
0157     inds(indb(i)) = i;
0158 <span class="keyword">end</span>
0159 
0160 <span class="comment">% update indices of faces</span>
0161 <span class="keyword">for</span> f = 1:length(faces2)
0162     face = faces2{f};
0163     faces2{f} = inds(face)';
0164 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 21-Nov-2024 11:30:22 by <strong><a href="https://github.com/gllmflndn/m2html">m2html</a></strong> &copy; 2003-2022</address>
</body>
</html>